{
  "swagger": "2.0",
  "info": {
    "title": "用户权限 API",
    "description": "用于建立用户-角色-权限的关系",
    "version": "1.0"
  },
  "produces": ["application/json"],
  "consumes": ["application/json"],
  "basePath": "/",
  "security": [{"cmApiKey": []}],
  "paths": {

    "/token/revoke": {
      "post": {
        "operationId": "access-token_revoke",
        "tags": ["token"],
        "parameters": [
          {"$ref": "#/parameters/token"}
        ],
        "responses": {
          "200": {
            "$ref": "#/responses/Success"
          }
        }
      }
    },

    "/token/is-revoked": {
      "post": {
        "operationId": "access-token_isRevoked",
        "tags": ["token"],
        "parameters": [
          {"$ref": "#/parameters/token"}
        ],
        "responses": {
          "200": {
            "$ref": "#/responses/Success"
          }
        }
      }
    },

    "/token/refresh": {
      "post": {
        "operationId": "access-token_refresh",
        "tags": ["token"],
        "parameters": [
          {"$ref": "#/parameters/token"}
        ],
        "responses": {
          "200": {
            "$ref": "#/responses/Success"
          }
        }
      }
    },

    "/auth/login": {
      "post": {
        "operationId": "user_login",
        "tags": ["auth"],
        "parameters": [
          {"$ref": "#/parameters/credentials"}
        ],
        "responses": {
          "200": {
            "$ref": "#/responses/Success"
          }
        }
      }
    },

    "/auth/signup": {
      "post": {
        "operationId": "user_signup",
        "tags": ["auth"],
        "parameters": [
          {"$ref": "#/parameters/credentials"}
        ],
        "responses": {
          "200": {"$ref": "#/responses/Success"}
        }
      }
    },

    "/api/users": {

      "get": {
        "operationId": "user_findAll",
        "tags": ["user"],
        "parameters": [
          {"$ref": "#/parameters/perPage"},
          {"$ref": "#/parameters/page"},
          {"$ref": "#/parameters/sortField"},
          {"$ref": "#/parameters/sortDir"},
          {"$ref": "#/parameters/filters"}
        ],
        "responses": {
          "200": {"$ref": "#/responses/Success"}
        }
      },

      "post": {
        "operationId": "user_create",
        "tags": ["user"],
        "parameters": [
          {"$ref": "#/parameters/userData"}
        ],
        "responses": {
          "200": {"$ref": "#/responses/Success"},
          "default": {"$ref": "#/responses/Error"}
        }
      }

    },

    "/api/users/{id}": {

      "get": {
        "operationId": "user_findById",
        "tags": ["user"],
        "parameters": [
          {"$ref": "#/parameters/id"}
        ],
        "responses": {
          "200": {"$ref": "#/responses/Success"}
        }
      },

      "put": {
        "operationId": "user_update",
        "tags": ["user"],
        "parameters": [
          {"$ref": "#/parameters/id"},
          {"$ref": "#/parameters/userData"}
        ],
        "responses": {
          "200": {"$ref": "#/responses/Success"}
        }
      },

      "delete": {
        "operationId": "user_destroy",
        "tags": ["user"],
        "parameters": [
          {"$ref": "#/parameters/id"}
        ],
        "responses": {
          "200": {"$ref": "#/responses/Success"}
        }
      }

    }
  },

  "definitions": {

    "User": {
      "properties": {
        "username": {
          "type": "string"
        },
        "password": {
          "type": "string"
        },
        "disabled": {
          "type": "boolean"
        },
        "revokedAt": {
          "type": "number"
        }
      }
    },

    "Credentials": {
      "properties": {
        "username": {
          "type": "string"
        },
        "password": {
          "type": "string"
        }
      }
    },

    "Error": {
      "properties": {
        "code": {
          "type": "integer"
        },
        "message": {
          "type": "string"
        },
        "detail": {
          "type": "object"
        }
      }
    }
  },

  "parameters": {

    "id": {
      "name": "id",
      "description": "实体 ID",
      "in": "path",
      "required": true,
      "type": "string"
    },

    "credentials": {
      "name": "credentials",
      "description": "登录凭证",
      "in": "body",
      "schema": {
        "$ref": "#/definitions/Credentials"
      }
    },

    "perPage": {
      "description": "每页条数",
      "name": "_perPage",
      "in": "query",
      "type": "integer"
    },

    "page": {
      "description": "分页页数",
      "name": "_page",
      "in": "query",
      "type": "integer"
    },

    "filters": {
      "description": "筛选条件",
      "name": "_filters",
      "in": "query",
      "type": "string"
    },

    "sortField": {
      "description": "排序字段",
      "name": "_sortField",
      "type": "string",
      "in": "query"
    },

    "sortDir": {
      "description": "排序方向",
      "name": "_sortDir",
      "type": "string",
      "in": "query",
      "enum": [
        "ASC",
        "DESC"
      ]
    },

    "userData": {
      "name": "data",
      "in": "body",
      "description": "用户实体数据",
      "schema": {
        "$ref": "#/definitions/User"
      }
    },

    "token": {
      "name": "token",
      "in": "query",
      "description": "用户 Token",
      "required": true,
      "type": "string"
    }

  },

  "responses": {
    "Success": {
      "description": "成功"
    },
    "Error": {
      "description": "失败"
    }
  },

  "securityDefinitions": {
    "cmApiKey": {
      "type": "apiKey",
      "name": "cm-api-key",
      "in": "header"
    }
  }
}
